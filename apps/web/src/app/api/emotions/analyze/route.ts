import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@designemotion/database';

/**
 * Content Templates –¥–ª—è –≤—Å–µ—Ö 9 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —ç–º–æ—Ü–∏–π
 * –û—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —à–∫–∞–ª–µ –•–æ–∫–∏–Ω—Å–∞ (20-1000) –∏ –º–µ—Ç–æ–¥–µ –°–µ–¥–æ–Ω–∞
 */
const contentTemplates: Record<string, {
  headline: string;
  problem: string;
  insights: string[];
}> = {
  /**
   * –ê–ü–ê–¢–ò–Ø (20-74) üò∂
   * –£—Ä–æ–≤–µ–Ω—å: –°–∞–º—ã–π –Ω–∏–∑–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏, –±–µ–∑–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –∏—Å—Ç–æ—â–µ–Ω–∏–µ
   */
  '–∞–ø–∞—Ç–∏—è': {
    headline: '–ê–ø–∞—Ç–∏—è –∑–∞–±–∏—Ä–∞–µ—Ç –≤–∞—à—É –ø–æ—Å–ª–µ–¥–Ω—é—é —ç–Ω–µ—Ä–≥–∏—é',
    problem: '–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –∏—Å—Ç–æ—â–µ–Ω–Ω—ã–º –µ—â–µ –¥–æ –Ω–∞—á–∞–ª–∞ –¥–Ω—è. –ù–µ—Ç –Ω–∏ —Å–∏–ª, –Ω–∏ –∂–µ–ª–∞–Ω–∏—è —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å. –ö–∞–∂–µ—Ç—Å—è, —á—Ç–æ –ª—é–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã, –∏ –Ω–∏—á—Ç–æ –Ω–µ –ø—Ä–∏–Ω–µ—Å–µ—Ç –æ–±–ª–µ–≥—á–µ–Ω–∏—è.',
    insights: [
      '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —ç–Ω–µ—Ä–≥–∏–µ–π —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è',
      '–ü–æ–Ω—è—Ç—å –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –∞–ø–∞—Ç–∏–∏ ‚Äî —ç—Ç–æ –Ω–µ –ª–µ–Ω—å, –∞ —Å–∏–≥–Ω–∞–ª',
      '–í–µ—Ä–Ω—É—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏ –∏–Ω—Ç–µ—Ä–µ—Å –∫ –∂–∏–∑–Ω–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º',
      '–ù–∞—É—á–∏—Ç—å—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∞–ø–∞—Ç–∏—é –Ω–∞ —Ä–∞–Ω–Ω–∏—Ö —Å—Ç–∞–¥–∏—è—Ö'
    ]
  },

  /**
   * –ü–ï–ß–ê–õ–¨ (75-99) üò¢
   * –£—Ä–æ–≤–µ–Ω—å: –ù–∏–∑–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –ü–æ—Ç–µ—Ä—è, –≥—Ä—É—Å—Ç—å, —Å–æ–∂–∞–ª–µ–Ω–∏–µ, –¥–µ–ø—Ä–µ—Å—Å–∏—è
   */
  '–ø–µ—á–∞–ª—å': {
    headline: '–ü–µ—á–∞–ª—å —Ç—É–º–∞–Ω–∏—Ç –≤–∞—à—É –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É',
    problem: '–í—ã –∑–∞—Å—Ç—Ä—è–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º, –ø–µ—Ä–µ–∂–∏–≤–∞—è –ø–æ—Ç–µ—Ä—é –∏–ª–∏ —Å–æ–∂–∞–ª–µ—è –æ —Ç–æ–º, —á—Ç–æ –±—ã–ª–æ. –ì—Ä—É—Å—Ç—å –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å—ë –≤–æ–∫—Ä—É–≥ –≤ —Å–µ—Ä—ã–µ —Ç–æ–Ω–∞, –∏ –±—É–¥—É—â–µ–µ –∫–∞–∂–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ –º—Ä–∞—á–Ω—ã–º.',
    insights: [
      '–ü—Ä–∏–Ω—è—Ç—å –ø–µ—á–∞–ª—å –∫–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –ø–æ—Ç–µ—Ä—é',
      '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∂–∞–ª–µ–Ω–∏–µ –≤ –º—É–¥—Ä–æ—Å—Ç—å –∏ –æ–ø—ã—Ç',
      '–û—Ç–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—à–ª–æ–µ –∏ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º',
      '–ù–∞–π—Ç–∏ —Å–º—ã—Å–ª –∏ —Ä–æ—Å—Ç –¥–∞–∂–µ –≤ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–º –æ–ø—ã—Ç–µ'
    ]
  },

  /**
   * –°–¢–†–ê–• (100-124) üò®
   * –£—Ä–æ–≤–µ–Ω—å: –ù–∏–∑–∫–æ-—Å—Ä–µ–¥–Ω–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –¢—Ä–µ–≤–æ–≥–∞, –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ, –ø–∞–Ω–∏–∫–∞, –ø–∞—Ä–∞–ª–∏–∑–∞—Ü–∏—è
   */
  '—Å—Ç—Ä–∞—Ö': {
    headline: '–°—Ç—Ä–∞—Ö –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–∞—à –ø–µ—Ä–≤—ã–π —à–∞–≥',
    problem: '–í—ã —á–µ—Ç–∫–æ –≤–∏–¥–∏—Ç–µ —Å–≤–æ—é —Ü–µ–ª—å, –Ω–æ —Å—Ç—Ä–∞—Ö –Ω–µ—É–¥–∞—á–∏, –æ—Å—É–∂–¥–µ–Ω–∏—è –∏–ª–∏ –ø–æ—Ç–µ—Ä–∏ –ø–∞—Ä–∞–ª–∏–∑—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è. –ú–æ–∑–≥ —Ä–∏—Å—É–µ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∏ –≤—ã –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç–µ –≤ –∑–æ–Ω–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞.',
    insights: [
      '–û—Å–æ–∑–Ω–∞—Ç—å –∏ –Ω–∞–∑–≤–∞—Ç—å —Å–≤–æ–π —Å—Ç—Ä–∞—Ö ‚Äî —ç—Ç–æ —É–∂–µ –ø–æ–ª–æ–≤–∏–Ω–∞ —Ä–µ—à–µ–Ω–∏—è',
      '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ö –∏–∑ –≤—Ä–∞–≥–∞ –≤ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª',
      '–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç—Ä–µ–≤–æ–≥—É',
      '–ü–æ–Ω—è—Ç—å, —á—Ç–æ —Å—Ç—Ä–∞—Ö ‚Äî —ç—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –ø–µ—Ä–µ–¥ —Ä–æ—Å—Ç–æ–º'
    ]
  },

  /**
   * –í–û–ñ–î–ï–õ–ï–ù–ò–ï (125-149) ü§§
   * –£—Ä–æ–≤–µ–Ω—å: –°—Ä–µ–¥–Ω–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –°–∏–ª—å–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å
   */
  '–≤–æ–∂–¥–µ–ª–µ–Ω–∏–µ': {
    headline: '–í–æ–∂–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–ª—å –≤ –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å',
    problem: '–í–∞—à–µ –∂–µ–ª–∞–Ω–∏–µ —Å—Ç–∞–ª–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã–º, —á—Ç–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–æ—Å—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥—É–º–∞—Ç—å –Ω–∏ –æ —á–µ–º –¥—Ä—É–≥–æ–º, –∏ —ç—Ç–æ –∂–µ–ª–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–∞—Å, –∞ –Ω–µ –≤—ã –µ–≥–æ.',
    insights: [
      '–û—Ç–¥–µ–ª–∏—Ç—å –∑–¥–æ—Ä–æ–≤–æ–µ –∂–µ–ª–∞–Ω–∏–µ –æ—Ç —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å–Ω–æ–π –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç–∏',
      '–ü–æ–Ω—è—Ç—å —Å–∫—Ä—ã—Ç—É—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –ø–æ–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–º –∂–µ–ª–∞–Ω–∏–µ–º',
      '–í–µ—Ä–Ω—É—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å, –æ—Å–ª–∞–±–∏–≤ —Ö–≤–∞—Ç–∫—É –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏',
      '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∂–¥–µ–ª–µ–Ω–∏–µ –≤ —Å–ø–æ–∫–æ–π–Ω–æ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ'
    ]
  },

  /**
   * –ó–õ–û–°–¢–¨ (150-174) üò°
   * –£—Ä–æ–≤–µ–Ω—å: –°—Ä–µ–¥–Ω–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –ì–Ω–µ–≤, —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ, —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏—è, –∞–≥—Ä–µ—Å—Å–∏—è
   */
  '–∑–ª–æ—Å—Ç—å': {
    headline: '–ó–ª–æ—Å—Ç—å —Å–∂–∏–≥–∞–µ—Ç –≤–∞—à—É —ç–Ω–µ—Ä–≥–∏—é –≤–ø—É—Å—Ç—É—é',
    problem: '–í—ã –∑–ª–∏—Ç–µ—Å—å –Ω–∞ —Å–µ–±—è, –¥—Ä—É–≥–∏—Ö –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é. –≠—Ç–∞ –º–æ—â–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –º–æ–≥–ª–∞ –±—ã –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—å –≤–∞—Å –≤–ø–µ—Ä–µ–¥, –Ω–æ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω–∞ —Ä–∞–∑—Ä—É—à–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—â–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.',
    insights: [
      '–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∑–ª–æ—Å—Ç—å –∏–∑ —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—è –≤ –º–æ—â–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π',
      '–ü–æ–Ω—è—Ç—å –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –≥–Ω–µ–≤–∞ ‚Äî –Ω–∞—Ä—É—à–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏',
      '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é –∑–ª–æ—Å—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ –°–µ–¥–æ–Ω–∞',
      '–ù–∞—É—á–∏—Ç—å—Å—è –≤—ã—Ä–∞–∂–∞—Ç—å –≥–Ω–µ–≤ –∑–¥–æ—Ä–æ–≤—ã–º —Å–ø–æ—Å–æ–±–æ–º'
    ]
  },

  /**
   * –ì–û–†–î–´–ù–Ø (175-199) üòè
   * –£—Ä–æ–≤–µ–Ω—å: –°—Ä–µ–¥–Ω–µ-–≤—ã—Å–æ–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –í—ã—Å–æ–∫–æ–º–µ—Ä–∏–µ, –∑–∞—â–∏—Ç–∞ —ç–≥–æ, –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ
   */
  '–≥–æ—Ä–¥—ã–Ω—è': {
    headline: '–ì–æ—Ä–¥—ã–Ω—è —Å–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é –∫–æ–Ω—Ç—Ä–æ–ª—è',
    problem: '–í—ã –∑–∞—â–∏—â–∞–µ—Ç–µ —Å–≤–æ—é –ø—Ä–∞–≤–æ—Ç—É –∏ —Å—Ç–∞—Ç—É—Å –ª—é–±–æ–π —Ü–µ–Ω–æ–π. –ü—Ä–∏–∑–Ω–∞—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ —Å–ª–∞–±–æ—Å—Ç—å –∫–∞–∂–µ—Ç—Å—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º, –≤–µ–¥—å —ç—Ç–æ —É–≥—Ä–æ–∂–∞–µ—Ç –≤–∞—à–µ–º—É —Å–∞–º–æ–æ—â—É—â–µ–Ω–∏—é. –ù–æ —ç—Ç–∞ –º–∞—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.',
    insights: [
      '–û—Ç–ø—É—Å—Ç–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤—Å–µ–≥–¥–∞ –±—ã—Ç—å –ø—Ä–∞–≤—ã–º',
      '–ü–æ–Ω—è—Ç—å, —á—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–∏–ª–∞, –∞ –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å',
      '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–¥—ã–Ω—é –≤ –∑–¥–æ—Ä–æ–≤—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É',
      '–û—Å–≤–æ–±–æ–¥–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –º–∞—Å–∫–∏'
    ]
  },

  /**
   * –ú–£–ñ–ï–°–¢–í–û (200-349) üí™
   * –£—Ä–æ–≤–µ–Ω—å: –í—ã—Å–æ–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
   */
  '–º—É–∂–µ—Å—Ç–≤–æ': {
    headline: '–ú—É–∂–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º',
    problem: '–í—ã –≥–æ—Ç–æ–≤—ã –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–æ –µ—â–µ –∫–æ–ª–µ–±–ª–µ—Ç–µ—Å—å –ø–µ—Ä–µ–¥ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å—é. –£ –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤, –Ω–æ –≤–∞–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å—Ç—Ä–∞—Ç–∏—Ç—å –≤–ø—É—Å—Ç—É—é.',
    insights: [
      '–£–∫—Ä–µ–ø–∏—Ç—å —Ä–µ—à–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ —è—Å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ü–µ–ª–∏',
      '–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∏–º–ø—É–ª—å—Å –≤ —É—Å—Ç–æ–π—á–∏–≤—É—é –ø—Ä–∞–∫—Ç–∏–∫—É',
      '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é –º—É–∂–µ—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤',
      '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏–µ–º –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π'
    ]
  },

  /**
   * –ü–†–ò–ù–Ø–¢–ò–ï (350-599) ü§ó
   * –£—Ä–æ–≤–µ–Ω—å: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –ì–∞—Ä–º–æ–Ω–∏—è, –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å, –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –ø—Ä–æ—â–µ–Ω–∏–µ
   */
  '–ø—Ä–∏–Ω—è—Ç–∏–µ': {
    headline: '–ü—Ä–∏–Ω—è—Ç–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é',
    problem: '–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è. –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ, –∏ –≤—ã –≤–∏–¥–∏—Ç–µ –≤–µ—â–∏ —Ç–∞–∫–∏–º–∏, –∫–∞–∫–∏–µ –æ–Ω–∏ –µ—Å—Ç—å. –¢–µ–ø–µ—Ä—å –≤–∞–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —è—Å–Ω–æ—Å—Ç—å –¥–ª—è –≥–ª—É–±–æ–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.',
    insights: [
      '–£–≥–ª—É–±–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É –ø—Ä–∏–Ω—è—Ç–∏—è —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å',
      '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏ –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π',
      '–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏–Ω—è—Ç–∏–µ –Ω–∞ –≤—Å–µ –æ–±–ª–∞—Å—Ç–∏ –∂–∏–∑–Ω–∏',
      '–°—Ç–∞—Ç—å –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º —ç—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö'
    ]
  },

  /**
   * –£–ú–ò–†–û–¢–í–û–†–ï–ù–ò–ï (600-1000) üôè
   * –£—Ä–æ–≤–µ–Ω—å: –í—ã—Å—à–∏–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
   * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞: –õ—é–±–æ–≤—å, —Ä–∞–¥–æ—Å—Ç—å, –±–ª–∞–∂–µ–Ω—Å—Ç–≤–æ, –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏–µ
   */
  '—É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ': {
    headline: '–£–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ ‚Äî –≤–∞—à–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ',
    problem: '–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–æ–∑–Ω–∞–Ω–∏—è, –≥–¥–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –∏ —Ä–∞–¥–æ—Å—Ç—å –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤. –≠—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–π –ª—é–±–≤–∏ –∏ –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∂–∏–∑–Ω–∏. –í–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —É–≥–ª—É–±–∏—Ç—å —ç—Ç–æ—Ç –æ–ø—ã—Ç.',
    insights: [
      '–£–∫—Ä–µ–ø–∏—Ç—å —Å–≤—è–∑—å —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∫–æ—è',
      '–î–µ–ª–∏—Ç—å—Å—è —ç—Ç–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å –º–∏—Ä–æ–º —á–µ—Ä–µ–∑ —Å–ª—É–∂–µ–Ω–∏–µ',
      '–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤—Å—ë —Ö–æ—Ä–æ—à–æ',
      '–ë—ã—Ç—å –º–∞—è–∫–æ–º –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –∏—â–µ—Ç –ø—É—Ç—å –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –º–∏—Ä—É'
    ]
  }
};

/**
 * POST /api/emotions/analyze
 * 
 * –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * 
 * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö —Å–µ—Å—Å–∏–π)
 * @param {string} emotionId - UUID —ç–º–æ—Ü–∏–∏ –∏–∑ –±–∞–∑—ã
 * @param {string} goal - –¶–µ–ª—å –∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param {string} context - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 'landing' | 'test' | 'bot'
 * @param {object} metadata - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
 * 
 * @returns {object} –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ —Å –∏–Ω—Å–∞–π—Ç–∞–º–∏
 */
export async function POST(request: NextRequest) {
  try {
    const { userId, emotionId, goal, context, metadata } = await request.json();

    // –í–∞–ª–∏–¥–∞—Ü–∏—è: emotionId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
    if (!emotionId) {
      return NextResponse.json({
        success: false,
        error: 'emotionId is required'
      }, { status: 400 });
    }

    // –ü–æ–ª—É—á–∏—Ç—å —ç–º–æ—Ü–∏—é –∏–∑ –ë–î
    const emotion = await prisma.emotion.findUnique({
      where: { id: emotionId },
      select: {
        id: true,
        name: true,
        emoji: true,
        category: true,
        level: true,
        description: true
      }
    });

    if (!emotion) {
      return NextResponse.json({
        success: false,
        error: 'Emotion not found'
      }, { status: 404 });
    }

    // –ü–æ–ª—É—á–∏—Ç—å content template –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (fallback –Ω–∞ '–º—É–∂–µ—Å—Ç–≤–æ' –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
    const categoryKey = emotion.category.toLowerCase();
    const content = contentTemplates[categoryKey] || contentTemplates['–º—É–∂–µ—Å—Ç–≤–æ'];

    // –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∞–Ω–∞–ª–∏–∑–∞ –≤ –ë–î –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å userId
    let analysisId = undefined;
    if (userId) {
      try {
        const analysis = await prisma.analysis.create({
          data: {
            userId,
            emotionId: emotion.id,
            emotionLevel: emotion.level,
            emotionCategory: emotion.category,
            situationBrief: goal || null,
            analysisType: context === 'bot' ? 'regular' : 'widget',
            notes: metadata ? JSON.stringify({ context, ...metadata }) : JSON.stringify({ context })
          }
        });
        analysisId = analysis.id;
      } catch (error) {
        console.error('‚ö†Ô∏è Error creating analysis:', error);
        // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
      }
    }

    // –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const result = {
      emotion: {
        id: emotion.id,
        name: emotion.name,
        emoji: emotion.emoji,
        category: emotion.category,
        level: emotion.level
      },
      goal: goal || '',
      headline: content.headline,
      problem: content.problem,
      insights: content.insights,
      hawkinsLevel: emotion.level,
      analysisId: analysisId,
      categoryDescription: getCategoryDescription(emotion.level)
    };

    return NextResponse.json({
      success: true,
      data: result
    });

  } catch (error) {
    console.error('‚ùå Error in /api/emotions/analyze:', error);
    return NextResponse.json({
      success: false,
      error: 'Analysis failed'
    }, { status: 500 });
  }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ —à–∫–∞–ª–µ –•–æ–∫–∏–Ω—Å–∞
 */
function getCategoryDescription(level: number): string {
  if (level < 75) {
    return '–ù–∏–∑–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞.';
  }
  if (level < 100) {
    return '–≠–Ω–µ—Ä–≥–∏—è –Ω–∞ –∏—Å—Ö–æ–¥–µ. –í—Ä–µ–º—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.';
  }
  if (level < 125) {
    return '–ë–ª–æ–∫–∏—Ä—É—é—â–∞—è —ç–Ω–µ—Ä–≥–∏—è. –ü–∞—Ä–∞–ª–∏–∑—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è.';
  }
  if (level < 150) {
    return '–≠–Ω–µ—Ä–≥–∏—è –∂–µ–ª–∞–Ω–∏—è. –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.';
  }
  if (level < 175) {
    return '–ú–æ—â–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è. –í–∞–∂–Ω–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ.';
  }
  if (level < 200) {
    return '–≠–Ω–µ—Ä–≥–∏—è –∑–∞—â–∏—Ç—ã. –¢—Ä–µ–±—É–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.';
  }
  if (level < 350) {
    return '–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π. –û—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç!';
  }
  if (level < 600) {
    return '–í—ã—Å–æ–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è. –ì–∞—Ä–º–æ–Ω–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å.';
  }
  return '–í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å. –õ—é–±–æ–≤—å, —Ä–∞–¥–æ—Å—Ç—å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä.';
}
